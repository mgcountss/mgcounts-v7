<script>
    let sideCountslength = parseFloat("<%=item.stats.length%>");
    let id = "<%=id%>";
    let lastCounter = localStorage.getItem("index_<%=id%>");
    if (lastCounter == null) {
        lastCounter = 0;
    }
    document.getElementById('embed').value = 'https://mgcounts.com/embeds<%=path%><%=id%>/' + lastCounter + '';
    function mainCount(e) {
        if (e == lastCounter) {
            e = 0;
            lastCounter = e;
            localStorage.setItem("index_<%=id%>", e);
            chart.series[0].update({
                data: []
            });
            document.getElementById('embed').value = 'https://mgcounts.com/embeds<%=path%><%=id%>/' + e + '';
            update();
        } else {
            lastCounter = e;
            localStorage.setItem("index_<%=id%>", e);
            chart.series[0].update({
                data: []
            });
            document.getElementById('embed').value = 'https://mgcounts.com/embeds<%=path%><%=id%>/' + e + '';
            update();
        }
    }
    function update() {
        fetch('/api<%=path%><%=id%>')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.misc && data.misc.length > 0) {
                        if (document.getElementById('name').innerHTML !== data.misc[0].value) {
                            document.getElementById('name').innerHTML = data.misc[0].value;
                        }
                        if (document.getElementById('img').src !== data.misc[1].value) {
                            document.getElementById('img').src = data.misc[1].value;
                        }
                        if (document.getElementById('banner').src !== data.misc[2].value) {
                            document.getElementById('banner').src = data.misc[2].value;
                        }
                    }
                    let index = localStorage.getItem("index_<%=id%>");
                    if (index == null) {
                        index = 0;
                    }
                    if (document.getElementById('count').innerHTML !== data.stats[index].value) {
                        document.getElementById('count').innerHTML = data.stats[index].value;
                        document.getElementById('label').innerHTML = data.stats[index].name;
                    }
                    //idk yet
                    if (sideCountslength < 3) {
                        document.getElementsByClassName('sideCounts')[0].style.gridTemplateColumns = "repeat(" + sideCountslength + ", 1fr)";
                    }
                    for (let q = 1; q < sideCountslength + 1; q++) {
                        if (q == sideCountslength) {
                            document.getElementById('count_' + q).innerHTML = getGoal(data.stats[index].value);
                        } else {
                            if (data.stats[q]) {
                                if (q == index) {
                                    document.getElementById('label_' + q).innerHTML = data.stats[0].name;
                                    document.getElementById('count_' + q).innerHTML = data.stats[0].value;
                                } else {
                                    document.getElementById('label_' + q).innerHTML = data.stats[q].name;
                                    document.getElementById('count_' + q).innerHTML = data.stats[q].value;
                                }
                            }
                        }
                    }
                    if (chart.series[0].points.length == config.graphLength) chart.series[0].data[0].remove();
                    chart.series[0].addPoint([Date.now(), Math.floor(data.stats[index].value)])
                    chart.series[0].update({
                        name: data.stats[index].name
                    })
                }
            })
    }
    setInterval(update, 5000);
    update();

    function embed() {
        document.getElementById('embed').select();
        document.execCommand('copy');
    }
</script>